# Sebastian PRD - Messaging Feature

**문서 버전**: 1.6
**최종 수정**: 2025-11-27
**상태**: Approved

---

## 1. 개요

이 문서는 Sebastian의 메시지 기능을 정의합니다.

**포함 기능**:
- 헤즈업 메시지 템플릿
- HO (Handoff) 메시지 템플릿

**동작 방식**: 템플릿 출력 → 사용자 복사 → 수동 발송 (API 자동 발송 X)

---

## 2. 기능 설명

### 2.1 개요

일정 계산기의 결과를 기반으로 메시지 템플릿을 생성하고, 사용자가 복사하여 사용할 수 있도록 출력합니다.

### 2.2 메시지 유형

| 유형 | 용도 | 발송 시점 |
|------|------|----------|
| 헤즈업 | 업데이트 일정 사전 안내 | 업데이트 일주일 전 |
| HO | 번역 자산 전달 안내 | 각 배치 전달 시 |

---

## 3. 템플릿 시스템

### 3.1 변수 시스템

#### 3.1.1 시스템 변수

**기본 변수**:

| 변수명 | 설명 | 예시 값 |
|--------|------|---------|
| `{project}` | 프로젝트명 | M4GL |
| `{update_date}` | 업데이트일 (YYMMDD) | 250115 |
| `{update_date_full}` | 업데이트일 전체 | 2025년 1월 15일 |
| `{milestone}` | 마일스톤 | M42 |
| `{batch_name}` | 배치명 | REGULAR |
| `{today}` | 오늘 날짜 | 1월 10일(금) |

**일정 변수** (일정 계산기에서 자동 생성):

| 변수명 | 설명 | 예시 값 |
|--------|------|---------|
| `{headsup_date}` | 헤즈업 날짜 | 1월 8일(수) |
| `{regular_ho_date}` | REGULAR HO 날짜 | 1월 8일(수) |
| `{regular_delivery_date}` | REGULAR Delivery 날짜 | 1월 10일(금) |
| `{extra0_ho_date}` | EXTRA0 HO 날짜 | 1월 10일(금) |
| `{extra0_delivery_date}` | EXTRA0 Delivery 날짜 | 1월 13일(월) |
| `{extra1_ho_date}` | EXTRA1 HO 날짜 | 1월 13일(월) |
| `{extra1_delivery_date}` | EXTRA1 Delivery 날짜 | 1월 14일(화) |
| `{batch_due_date}` | 선택된 배치 마감일 | 1월 10일(금) |

#### 3.1.2 사용자 정의 변수

사용자가 설정에서 추가 변수를 정의할 수 있습니다.

**추가 방법**: 설정 → 템플릿 변수 → [추가]

**형식**: `{변수명}` (영문, 숫자, 언더스코어)

**예시**:
- `{recipient_team}`: 수신 팀명
- `{folder_link}`: NAS 폴더 링크
- `{special_note}`: 특별 안내사항

#### 3.1.3 변수 치환

템플릿 생성 시 변수가 실제 값으로 치환됩니다:

```
입력: "{project} {update_date} 업데이트 일정을 안내드립니다."
출력: "M4GL 250115 업데이트 일정을 안내드립니다."
```

**치환 실패 처리**:

정의되지 않은 변수를 만나면 경고 표시로 치환합니다:

```
입력: "{project} {undefined_var} 업데이트"
출력: "M4GL [ERROR: undefined_var] 업데이트"
```

**실패 감지 및 로그**:
- 치환 완료 후 `[ERROR:` 패턴 검색
- 발견 시 로그에 경고 기록: `[WARNING] 템플릿 변수 치환 실패: undefined_var`
- 사용자에게 토스트 알림: "⚠️ 일부 변수를 치환할 수 없습니다. 템플릿을 확인하세요."
- 출력은 정상적으로 진행 (사용자가 직접 수정 가능)

---

### 3.2 템플릿 관리

#### 3.2.1 저장 위치

`templates.json` 파일에 프로젝트별, 유형별로 저장

#### 3.2.2 템플릿 구조

```json
{
  "templates": {
    "M4GL": {
      "headsup": {
        "subject": "{project} {update_date} 업데이트 일정 안내",
        "body": "안녕하세요.\n\n{project} {update_date_full} 업데이트 일정을 안내드립니다.\n\n..."
      },
      "handoff": {
        "subject": "{project} {update_date} {batch_name} HO",
        "body": "안녕하세요.\n\n{batch_name} 자산을 전달드립니다.\n\n..."
      }
    },
    "NCGL": {
      "headsup": { ... },
      "handoff": { ... }
    }
  }
}
```

#### 3.2.3 템플릿 편집

**와이어프레임 참조**: `sebastian-prd-wireframes.md` 6.2절

**시안 참조**: `prd/wireframes/6.2_템플릿_편집_다이얼로그/`
- `code.html` - HTML/CSS 코드
- `screen.png` - 렌더링된 시안 이미지

설정 화면에서 프로젝트별, 유형별 템플릿을 편집할 수 있습니다.

```
┌─────────────────────────────────────────────┐
│ 템플릿 편집                                  │
├─────────────────────────────────────────────┤
│ 프로젝트: [M4GL ▼]  유형: [헤즈업 ▼]          │
├─────────────────────────────────────────────┤
│ 제목:                                       │
│ ┌─────────────────────────────────────────┐ │
│ │ {project} {update_date} 업데이트 일정 안내 │ │
│ └─────────────────────────────────────────┘ │
│                                             │
│ 본문:                                       │
│ ┌─────────────────────────────────────────┐ │
│ │ 안녕하세요.                              │ │
│ │                                         │ │
│ │ {project} {update_date_full} 업데이트    │ │
│ │ 일정을 안내드립니다.                     │ │
│ │                                         │ │
│ │ ...                                     │ │
│ └─────────────────────────────────────────┘ │
│                                             │
│ 사용 가능 변수: {project}, {update_date}, ...│
│                                             │
│ [저장]  [취소]  [기본값으로 복원]             │
└─────────────────────────────────────────────┘
```

**편집 중 프로젝트/유형 변경 시 동작**:
- **트리거**: 사용자가 제목 또는 본문을 수정한 후, 저장하지 않고 프로젝트 또는 유형 드롭다운을 변경하려 할 때
- **변경 감지**: 로드된 템플릿과 현재 입력값 비교
- **저장 확인 다이얼로그**:
  ```
  변경사항이 저장되지 않았습니다.

  저장하시겠습니까?

  [저장] [저장 안 함] [취소]
  ```
- **버튼 동작**:
  - [저장]: 현재 템플릿 저장 → 선택된 프로젝트/유형으로 전환
  - [저장 안 함]: 변경사항 무시 → 선택된 프로젝트/유형으로 전환
  - [취소]: 프로젝트/유형 변경 취소 → 현재 화면 유지

---

## 4. 헤즈업 메시지

### 4.1 기능 설명

업데이트 일정을 사전에 안내하는 메시지를 생성합니다.

### 4.2 기본 템플릿 구조

> **참고**: 템플릿 본문은 사용자가 설정 화면에서 직접 작성합니다. 아래는 변수를 활용한 예시 구조입니다.
> - PRD에서는 사용 가능한 **변수 목록**만 정의합니다.
> - 초기 설치 시 빈 템플릿이 제공되며, 사용자가 직접 본문을 작성합니다.

**M4GL, FBGL, LYGL** (마일스톤 없음):

**제목**:
```
{project} {update_date} 업데이트 일정 안내
```

**본문**:
```
안녕하세요.

{project} {update_date_full} 업데이트 일정을 안내드립니다.

**주요 일정**
- 헤즈업: {headsup_date}
- REGULAR HO: {regular_ho_date}
- REGULAR Delivery: {regular_delivery_date}
- EXTRA0 HO: {extra0_ho_date}
- EXTRA0 Delivery: {extra0_delivery_date}
- EXTRA1 HO: {extra1_ho_date}
- EXTRA1 Delivery: {extra1_delivery_date}

자세한 일정은 JIRA Epic을 참고해주세요.
감사합니다.
```

**NCGL** (마일스톤 포함):

**제목**:
```
{project} {milestone} {update_date} 업데이트 일정 안내
```

**본문**:
```
안녕하세요.

{project} {milestone} {update_date_full} 업데이트 일정을 안내드립니다.

**주요 일정**
- 헤즈업: {headsup_date}
- REGULAR HO: {regular_ho_date}
- REGULAR Delivery: {regular_delivery_date}
- EXTRA0 HO: {extra0_ho_date}
- EXTRA0 Delivery: {extra0_delivery_date}
- EXTRA1 HO: {extra1_ho_date}
- EXTRA1 Delivery: {extra1_delivery_date}

자세한 일정은 JIRA Epic을 참고해주세요.
감사합니다.
```

### 4.3 입력

일정 계산기에서 [헤즈업] 버튼 클릭 시:
- 프로젝트 정보
- 업데이트일
- 계산된 마일스톤 일정

### 4.4 출력

템플릿에 변수가 치환된 완성 메시지:
- 제목
- 본문

---

## 5. HO (Handoff) 메시지

### 5.1 기능 설명

번역 자산 전달을 안내하는 메시지를 생성합니다.

### 5.2 기본 템플릿 구조

> **참고**: 템플릿 본문은 사용자가 설정 화면에서 직접 작성합니다. 아래는 변수를 활용한 예시 구조입니다.

**M4GL, FBGL, LYGL** (마일스톤 없음):

**제목**:
```
{project} {update_date} {batch_name} HO
```

**본문**:
```
안녕하세요.

{project} {update_date} {batch_name} HO를 전달드립니다.

**전달 정보**
- 배치: {batch_name}
- 전달일: {today}
- 마감일: {batch_due_date}

**폴더 위치**
{folder_link}

확인 부탁드립니다.
감사합니다.
```

**NCGL** (마일스톤 포함):

**제목**:
```
{project} {milestone} {update_date} {batch_name} HO
```

**본문**:
```
안녕하세요.

{project} {milestone} {update_date} {batch_name} HO를 전달드립니다.

**전달 정보**
- 마일스톤: {milestone}
- 배치: {batch_name}
- 전달일: {today}
- 마감일: {batch_due_date}

**폴더 위치**
{folder_link}

확인 부탁드립니다.
감사합니다.
```

**참고**: `{folder_link}`는 사용자 정의 변수로 추가 필요

### 5.3 입력

일정 계산기에서 배치 선택 후 [HO] 버튼 클릭 시:
- 프로젝트 정보
- 업데이트일
- 선택된 배치 정보

### 5.4 출력

템플릿에 변수가 치환된 완성 메시지:
- 제목
- 본문

---

## 6. UI 구성

### 6.1 메시지 생성 화면

일정 계산기 결과 화면에서 접근:

```
┌─────────────────────────────────────────────┐
│ 일정 계산 결과                               │
├─────────────────────────────────────────────┤
│ (일정 테이블)                                │
├─────────────────────────────────────────────┤
│ [JIRA 일감 생성] [폴더 생성] [헤즈업] [HO ▼] │
└─────────────────────────────────────────────┘
```

HO 버튼 클릭 시 배치 선택 드롭다운:
- REGULAR
- EXTRA0
- EXTRA1

### 6.2 메시지 출력 화면

**와이어프레임 참조**:
- `sebastian-prd-wireframes.md` 3.7절 (헤즈업)
- `sebastian-prd-wireframes.md` 3.8절 (HO)

**시안 참조**:
- `prd/wireframes/3.7_메시지_출력_헤즈업/` - 헤즈업 메시지
- `prd/wireframes/3.8_메시지_출력_HO/` - HO 메시지

```
┌─────────────────────────────────────────────┐
│ 헤즈업 메시지                                │
├─────────────────────────────────────────────┤
│ 제목:                                       │
│ ┌─────────────────────────────────────────┐ │
│ │ M4GL 250115 업데이트 일정 안내           │ │
│ └─────────────────────────────────────────┘ │
│ [복사]                                      │
│                                             │
│ 본문:                                       │
│ ┌─────────────────────────────────────────┐ │
│ │ 안녕하세요.                              │ │
│ │                                         │ │
│ │ M4GL 2025년 1월 15일 업데이트 일정을     │ │
│ │ 안내드립니다.                            │ │
│ │                                         │ │
│ │ [일정]                                  │ │
│ │ - 헤즈업: 1월 8일(수)                    │ │
│ │ - REGULAR HO: 1월 8일(수)                │ │
│ │ - REGULAR Delivery: 1월 10일(금)         │ │
│ │ ...                                     │ │
│ └─────────────────────────────────────────┘ │
│ [복사]                                      │
│                                             │
│ [전체 복사]  [닫기]                          │
└─────────────────────────────────────────────┘
```

### 6.3 복사 기능

| 버튼 | 동작 |
|------|------|
| 제목 [복사] | 제목만 클립보드에 복사 |
| 본문 [복사] | 본문만 클립보드에 복사 |
| [전체 복사] | 제목 + 줄바꿈 + 본문 복사 |

복사 완료 시 "복사되었습니다" 토스트 표시

---

## 7. 설정 연동

### 7.1 템플릿 설정 참조

- `templates.json`에서 프로젝트별 템플릿 로드
- 시스템 변수 및 사용자 정의 변수 목록 로드

### 7.2 프로젝트 설정 참조

- `projects.json`에서 NAS 경로 등 프로젝트 정보 로드
- 일정 계산 결과에서 날짜 정보 로드

---

## 8. 확장 가능성

### 8.1 향후 추가 가능 기능

- **미리보기 모드**: 변수 치환 전/후 비교
- **다중 언어 템플릿**: 영문/국문 버전
- **첨부 파일 목록**: 자동 생성
- **직접 발송**: Slack/이메일 API 연동 (현재 미지원)

---

## 부록 A: 참조 문서

- `sebastian-prd-shared.md`: 공통 컴포넌트 (템플릿 변수 시스템)
- `sebastian-prd-scheduler.md`: 일정 계산기
- `sebastian-prd-master.md`: 마스터 문서

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|-----------|
| 1.0 | 2025-11-20 | 초안 작성 - 라운드 1-4 답변 반영 |
| 1.1 | 2025-11-25 | 검증 완료, 승인 |
| 1.2 | 2025-11-26 | Draft 재전환 (변경 사항 없음) |
| 1.3 | 2025-11-27 | 버전 동기화 (master.md와 일치) |
| 1.4 | 2025-11-27 | PRD 정제 라운드 1: 템플릿 편집 중 프로젝트 변경 시 저장 확인 로직 추가 |
| 1.5 | 2025-11-27 | PRD 정제 라운드 2: 템플릿 변수 치환 실패 처리 추가 (3.1.3절) |
| 1.6 | 2025-11-27 | UI 시안 참조 추가: wireframes 폴더 연결 (3.2.3, 6.2절) |
